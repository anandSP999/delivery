<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        .video-bg { position: fixed; top:0; left:0; min-width:100%; min-height:100%; z-index:-1; filter:brightness(0.2); object-fit:cover; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="text-white font-sans selection:bg-blue-500">

    <video autoplay muted loop playsinline class="video-bg">
        <source src="https://cdn.pixabay.com/video/2021/04/12/70796-536093156_tiny.mp4" type="video/mp4">
    </video>

    <div id="auth-wall" class="fixed inset-0 flex items-center justify-center z-50 p-6 bg-black/60">
        <div class="glass p-10 rounded-[3rem] w-full max-w-sm shadow-2xl">
            <h2 class="text-3xl font-black italic text-blue-400 mb-6 text-center">ADMIN ACCESS</h2>
            <input type="email" id="email" placeholder="Email" class="w-full bg-white/5 p-4 rounded-2xl mb-4 border border-white/10 outline-none focus:border-blue-500">
            <input type="password" id="pass" placeholder="Password" class="w-full bg-white/5 p-4 rounded-2xl mb-8 border border-white/10 outline-none focus:border-blue-500">
            <button onclick="login()" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-sm tracking-widest hover:scale-105 transition shadow-lg">AUTHORIZE</button>
        </div>
    </div>

    <div id="main-panel" class="hidden p-4 md:p-12 max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-12">
            <h1 class="text-4xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">DASHBOARD</h1>
            <button onclick="logout()" class="bg-white/10 px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-widest">Logout</button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="glass p-8 rounded-[2.5rem]">
                <h2 class="text-blue-400 font-bold mb-6">⊕ NEW PROJECT</h2>
                <div class="space-y-4">
                    <input type="text" id="cid" placeholder="Client ID (e.g., vishal01)" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="text" id="cn" placeholder="Client Name" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="text" id="t" placeholder="Project Title" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="text" id="v" placeholder="G-Drive Preview Link" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="text" id="f" placeholder="Final Link" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="number" id="p" placeholder="Price (INR)" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <input type="text" id="q" placeholder="QR Image URL" class="w-full bg-black/40 p-4 rounded-xl border border-white/10">
                    <button onclick="save()" class="w-full bg-blue-600 py-4 rounded-2xl font-black mt-4 shadow-xl">DEPLOY LINK</button>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-4">
                <h2 class="font-bold text-slate-400 mb-2">ACTIVE CLIENTS</h2>
                <div id="list" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyClH2MyqJG0qkuOT5LokfxdYlLY8guW79Q",
            authDomain: "videodelivery-1.firebaseapp.com",
            databaseURL: "https://videodelivery-1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "videodelivery-1",
            storageBucket: "videodelivery-1.firebasestorage.app",
            messagingSenderId: "172604228077",
            appId: "1:172604228077:web:1275b0733029b19aefa7e4"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        function login() {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value)
                .then(() => { document.getElementById('auth-wall').style.display='none'; document.getElementById('main-panel').classList.remove('hidden'); })
                .catch(e => alert("Invalid Access"));
        }
        function logout() { auth.signOut().then(() => location.reload()); }

        function convert(url) {
            if (url.includes('drive.google.com')) {
                let id = url.includes('/file/d/') ? url.split('/file/d/')[1].split('/')[0] : url.split('id=')[1].split('&')[0];
                return `https://docs.google.com/uc?export=download&id=${id}`;
            }
            return url;
        }

        function save() {
            const id = document.getElementById('cid').value;
            db.ref('projects/' + id).set({
                cn: document.getElementById('cn').value,
                t: document.getElementById('t').value,
                p: document.getElementById('p').value,
                v: convert(document.getElementById('v').value),
                f: document.getElementById('f').value,
                q: document.getElementById('q').value,
                paid: false, seen: "Never"
            });
            alert("Success! Project Live.");
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-wall').style.display='none';
                document.getElementById('main-panel').classList.remove('hidden');
                db.ref('projects').on('value', s => {
                    const l = document.getElementById('list'); l.innerHTML = '';
                    s.forEach(c => {
                        const d = c.val(); const k = c.key;
                        l.innerHTML += `
                        <div class="glass p-6 rounded-3xl flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h3 class="font-bold text-lg">${d.t}</h3>
                                <p class="text-xs text-slate-400 italic">ID: ${k} | Price: ₹${d.p}</p>
                                <p class="text-[10px] text-cyan-400 font-bold mt-2 uppercase tracking-widest">Seen: ${d.seen}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="toggle('${k}', ${!d.paid})" class="px-5 py-2 rounded-xl text-[10px] font-black uppercase ${d.paid ? 'bg-green-600' : 'bg-red-600'}">${d.paid ? 'Unlocked' : 'Locked'}</button>
                                <button onclick="inv('${k}')" class="px-5 py-2 rounded-xl text-[10px] font-black uppercase border border-white/20">Invoice</button>
                                <button onclick="del('${k}')" class="px-5 py-2 rounded-xl text-[10px] font-black uppercase border border-red-500 text-red-500">Delete</button>
                            </div>
                        </div>`;
                    });
                });
            }
        });

        function toggle(id, s) { db.ref('projects/' + id).update({ paid: s }); }
        function del(id) { if(confirm("Permanently delete?")) db.ref('projects/' + id).remove(); }
        function inv(id) {
            db.ref('projects/' + id).once('value', (s) => {
                const data = s.val();
                const text = `INVOICE\n\nClient: ${data.cn}\nProject: ${data.t}\nAmount: ₹${data.p}\nStatus: Paid\nDate: ${new Date().toLocaleDateString()}`;
                const blob = new Blob([text], {type: "text/plain"});
                const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `Invoice_${id}.txt`; a.click();
            });
        }
    </script>
</body>
</html>
